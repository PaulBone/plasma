name: CI

on: [push, pull_request]

jobs:
  test:
    name: Test (${{ matrix.buildType }} ${{ matrix.c }})
    runs-on: ubuntu-latest
    strategy:
      matrix:
        c: [gcc, clang]
        buildType: [dev, rel]
      fail-fast: false

    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: setup
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: setup
        c: ${{ matrix.c }}
        buildType: ${{ matrix.buildType }}
    - name: build
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: build
    - name: test
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: test
    - name: gctest
      uses: PlasmaLang/ci/rotd@v1
      if: matrix.buildType == 'dev'
      with:
        command: gctest

  docs:
    name: Build docs
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false

    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: docs
      uses: PlasmaLang/ci/docs@v1

  lint:
    name: Lint (${{ matrix.buildType }})
    runs-on: ubuntu-latest
    strategy:
      matrix:
        buildType: [dev, rel]
      fail-fast: false
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: setup
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: setup
        c: clang
        buildType: ${{ matrix.buildType }}
        lint: lint
    - name: build
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: build
    - name: extra
      uses: PlasmaLang/ci/rotd@v1
      with:
        command: extra

